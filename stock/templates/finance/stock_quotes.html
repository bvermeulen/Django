{% extends 'base.html' %}

{% load crispy_forms_tags %}

{% block title %}Stock quotes{% endblock %}

{% block stylesheet %}
<style>
  .item_select
      { color: black;
        font-weight: normal;
        font-size: 1.1em;
      }
  .item_select:hover { color: black;
                       font-weight: bold;
                       font-size: 1.2em;
                       background-color: darkgrey;
      }
</style>
{% endblock %}

{% block breadcrumb %}
<ol class="breadcrumb my-4">
  <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
  <li class="breadcrumb-item active">Stock Quotes</li>
</ol>
{% endblock %}

{% block content %}
{% now "Y-m-d" as current_date %}

<form id="stockquote" method="post">
{% csrf_token %}
  <div>
    {{ form.quote_string }}
    <a>
      <button class="btn dropdown-toggle btn-primary btn-sm" data-toggle="dropdown"
        >Portfolio's<span class="caret"></span></button>
        <ul class="dropdown-menu" style="height:40%; overflow:hidden; overflow-y:scroll;">
     		 	 {% for portfolio in portfolios %}
     			   <li><input type="submit" class="btn btn-sm item_select" name="selected_portfolio" value="{{ portfolio }}"></input></li>
     			 {% endfor %}
     		</ul>
    </a>
    <a>
      <button class="btn dropdown-toggle btn-primary btn-sm" data-toggle="dropdown"
        >Markets<span class="caret"></span></button>
        <ul class="dropdown-menu" style="height:40%; overflow:hidden; overflow-y:scroll;">
          {{ form.markets|as_crispy_field }}
        </ul>
    </a>
    <input type='submit' value='Quote' class="btn-sm btn-primary"></input>
  </div>
<table class="table table-striped mb-4">
  <thead class="thead-inverse">
  <tr>
    <th>Company</th>
    <th>Symbol</th>
    <th>Market</th>
    <th>Cur.</th>
    <th></th>
    <th>Price</th>
    <th>+/-</th>
    <th>Pct</th>
    <th>Low</th>
    <th>High</th>
    <th>Previous</th>
    <th>Last trade</th>
  </tr>
  </thead>
  <tbody>
  {% for stock in stock_info %}
    <tr>
    <td class="align-left"><a href="{% url 'stock_intraday' stock.symbol %}">{{ stock.name|truncatechars:20 }}</a></td>
    <td class="align-left">{{ stock.symbol }}</td>
    <td class="align-left">{{ stock.stock_exchange_short }}</td>
    <td class="align-left">{{ stock.currency }}</td>
    <td class="align-left" style="width:5px; color:{{ stock.font_color }}">{{ stock.caret_up_down }}</td>
    <td class="align-left" style="color:{{ stock.font_color }}">{{ stock.price }}</td>
    <td class="align-left" style="color:{{ stock.font_color }}">{{ stock.day_change }}</td>
    <td class="align-left" style="color:{{ stock.font_color }}"">{{ stock.change_pct }}%</td>
    <td class="align-left">{{ stock.day_low }}</td>
    <td class="align-left">{{ stock.day_high }}</td>
    <td class="align-left">{{ stock.close_yesterday }}</td>
    {% if current_date > stock.last_trade_time|date:"Y-m-d" %}
      <td class="align-left">{{ stock.last_trade_time|date:"j M y, H:i" }}</td>
    {% else %}
      <td class="align-left">{{ stock.last_trade_time|date:"h:i a" }}</td>
    {% endif %}
    </tr>
  {% endfor %}
</table>
</form>
<small>Data provided by <a href="https://{{ data_provider_url }}">{{ data_provider_url }}</a></small>
<br><br><br><br>
{% endblock content %}

{% block javascript %}
{% endblock %}
